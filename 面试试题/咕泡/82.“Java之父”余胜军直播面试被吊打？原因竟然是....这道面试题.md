Java支付于胜军，直播面试被吊打，原因竟然是这道面试题，听说了吗？昨天it界发生了一件非常有趣的事情，这个事情啊导致Java支付于胜军的直播间人数狂飙到2000人，评论区的言论一边倒引发了对Java支付这个头型的质疑和嘲讽事情这样的。昨天晚上啊 Java之后，于胜军和陆总监直播连麦进行互动，本来聊天氛围和直播间氛围都还不错，然后陆总监突然向Java之父提出一个面试题，跟他。说个事，啊就是那天有一个同学问了我一个问题，啊他说他们有一个场景是这样的，我们是有一个长链接，这长链接的话，当我这个客户端去服务器起的时候会有客户端去联系，吧但是我这个服务器也是一个集群群的，但是呢当我去这种波浪重启的时候，呢会发现重启完成之后，我的某些服务器它的这个链接数量特别高，造成了一个负载不均衡的一种情况。他问我怎么解决结果。Java之父竟然没有答出来，最精彩的是评论区一堆看热闹不嫌事大的人开始带节奏，事情愈演愈烈，直播间人数从1000直接狂飙到2000人。
	今天呢我就给大家分享一下这个问题的解决思路。这个问题其实并不难，我梳理一下这个问题的背景客户端和多个目标服务节点保持长连接，然后通过负载均衡机制对连接进行一个分发，形成了这样一个结构。假设现在需要进行停机发布，按照发布流程会先切掉一部分机器的流量进行重启，这就会导致原本的长连接会断开，而这个时候客户端会触发重连操作，使得这些长连接呢全部连接到其他没有重启的节点上，那么问题来了，因为客户端建立的是长连接，所以节点重启以后，客户的连接呢不会触发重连，使得新的节点不会有任何流量接入，而老的节点的连接数量会暴增，出现旱的旱死，闹着闹死的现象，问怎么解决这个问题？很多同学看到这个问题的第一反应一定跟Java支付于胜军一样，没有任何思路，但是我们仔细来分析一下这个问题的背景，这存在几个已知的前提。第一，客户端和多个目标服务节点建立连接，并且实现动态负载均衡，意味着需要用到注册中心来实现服务的上下线感知。
	第二，客户端层面会存在一个长连接管理机制来维护每个连接的状态。有了这样一个前提，那这个问题就很好解决了。服务下线以后基于注册中心的感知机制，客户端会收到服务地址变更的通知，于是客户端可以把所有失败的连接删除，并重新向健康的节点发起连接就好了。同样道理，当新发布的节点重新启动以后，数据中心也同样会触发一个地址变更的通知，于是客户端收到这个通知以后，把本地长连接池里面的长连接全部销毁掉，并重新建立新的连接，触发新的new balance机制就好了。在直播间里面陆总监说了一个卡夫卡德驴贝勒斯的解决方案的一个思路，我们确实可以去借鉴这个思想去解决这个问题。不过aaah卡夫卡的白的机制其实也是有一个第三方的coordinator协调机制来完成的，和我们上面说的这个思路是类似的，本质上来说都需要一个第三方的节点来感知服务上下线的状态，以及重新触发新的连接平衡机制。最后我还是要说一下，任何一个没有相关经验的人，遇到类似的问题的时候要立刻给出解决方案，并且还是在上千人的直播间，确实是有很大的难度的。
	而且在企业界开发中，我们在设计一个技术解决方案的时候，同样也是经过多次思考和修改，并且还需要做技术方案的评审，最后才会落地实施，所以啊大家还是要鼓励这些通过付出自己的时间和精力，给大家带来技术提升的知识博主。我是麦克，今天的分享就到这里，欢迎大家关注和点赞。另外我把网签的内容都打包在了Java面试指南中，里面包含了35万字面试文档，200份精选简历模板以及Java架构师学习路线图。