TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。TCP 的设计目的是为了在不可靠的网络中提供可靠的数据传输服务。TCP 的三次握手（Three-Way Handshake）是建立一个 TCP 连接的过程，其主要目的是为了确保连接的双方都能正常通信，并且能够确认对方的存在。下面是三次握手的具体步骤及原因：

### 三次握手步骤

1. **SYN（同步序列编号）**：

   - 客户端向服务器发送一个 SYN（同步）报文段，并进入 SYN_SENT 状态。这个报文段中包含一个初始序列号 ISN（Initial Sequence Number），用于标识后续数据的第一个字节的序号。

2. **SYN-ACK（同步-确认）**：

   - 服务器收到 SYN 报文段后，如果同意建立连接，就发送一个 SYN-ACK 报文段，并进入 SYN_RECEIVED 状态。这个报文段中也包含一个初始序列号 ISN，并且确认了客户端发送的 SYN 报文段中的序列号。

3. **ACK（确认）**：
   - 客户端收到服务器的 SYN-ACK 报文段后，向服务器发送一个 ACK（确认）报文段，确认收到了服务器的 SYN-ACK，并进入 ESTABLISHED 状态。此时连接正式建立。

### 三次握手的原因

1. **确保双方都准备好**：

   - 第一次握手确保客户端准备好发送数据，并且知道服务器的地址。
   - 第二次握手确保服务器已经准备好接收数据，并且客户端知道了服务器的初始序列号。
   - 第三次握手确保客户端收到了服务器的确认，并且服务器也确认了客户端的状态。

2. **解决网络延迟问题**：

   - 如果只有两次握手，那么在第二次握手之后，如果客户端没有收到服务器的确认，可能会重传 SYN 报文。但是如果之前的服务器的确认报文由于网络延迟最终到达了客户端，那么客户端会误以为连接已经建立，但实际上服务器可能没有收到客户端的确认报文，导致连接没有真正建立起来。

3. **防止已失效的连接请求报文突然又传送到了服务器**：
   - 如果只有两次握手，那么在第一次握手之后，如果客户端没有收到服务器的确认，可能会重传 SYN 报文。如果之前的 SYN 报文由于网络延迟最终到达了服务器，那么服务器会认为这是一个新的连接请求，并发送 SYN-ACK 报文，导致不必要的连接建立。三次握手可以避免这种情况。

通过三次握手，TCP 协议确保了连接的可靠性和有效性，同时也防止了因为网络延迟等原因导致的连接问题。这是 TCP 协议设计中非常重要的一部分，确保了在不可靠的网络环境下依然能够提供可靠的数据传输服务。


/**/
TCP协议为什么要设计三次握手，你知道该怎么回答吗？一个工作5年的粉丝啊最近去面试了很多的公司，每一次都被各种技术原理问得语无伦次，因为他找了一个月的时间还没有找到工作，有点焦虑来向我求助，我能做的呢只是保证每一天去更新一个面试题。然后我问他印象中最深刻的一个面试题是什么？他说 TCP协议为什么要设计三次握手，我怎么知道？那么对于这个问题呢我们看看普通人和高手的回答。我整理了一份2024年最新的面试文档，有这个问题的满分回答，其中还包括52万字的技术场景问题的分析和85万字的技术面试与分析，可以在我的评论区留言求分享，免费去联系一下。普通人的回答。Tcp为什么要设计三次握手？我认为啊就是因为TCP它是一个双攻协议，双攻协议的话呢就是意味着它可以双向去进行数据传输。嘛那么既然既然数据双向传输的话，那么意味着我比如说就是我两端都是建立一个通信连接，嘛两端都是彼此之间双向间连接，嘛所以相当于说a要向b间的连接，b要向a间的连接，这两个之间就这就是两侧。
	然后再加上我在这个电力连接过程中，我还需要确认这个连接是不是是不是建立成功，嘛所以嗯在a发送给就是客户端发送给服务端这个链接的时候，它需要给一个一个一个一个回应，嘛然后同样的道理也是一样，就是服务端也需要去发送和接收这样一个请求，所以他这边就会有三次握手。嗯这是我的理解。高手的回答。关于这个问题啊我会从下面三个方面来回答。第一个啊 Tcp协议是一种可靠的基于字节流的面向连接的一个传输协议，可靠性体现在TCP协议通信的双方的数据传输是稳定的，即便是在网络不好的情况下，TCP都能够去保证数据传输到目标端，然后TCP通讯双方的数据传输啊是通过字节流来实现传输的。最后面向连接是说在数据传输之前必须要建立一个连接，然后基于这个连接来进行数据传输。第二个因为TCP是面向连接的协议，所以在进行数据通信之前需要建立一个可靠的连接，TCP呢采用了三次握手的方式来实现连接的一个建立。所谓的三次握手，其实就是通信双方一共需要发送三次请求，才能确保一个可靠连接的一个建立。
	第一次是客户端向服务端发送连接请求，并且携带同步序号syn。第二次是服务端收到请求之后，发送sym和ack那么这里的sy呢表示是服务端的一个同步序列号，ack啊表示的是对前面的客户端的这个请求的一个确认，表示告诉客户端我收到你的请求了。第三次客户端收到服务端请求之后，再一次发送SK，而这个SK是针对服务端的连接的一个确认表示告诉服务端，我收到了你的一个请求。第三个点，之所以啊 TCP设计三次握手，我认为有三个方面的原因，第一个TCP是一个可靠的通信协议，所以TCP协议的通信双方都必须要维护一个序列号，去标记已经发送出去的一个数据包，哪些是已经被对方签收的，而三次握手就是通信双方去相互告知序列号的一个初始值，为了确保这个序列号被收到，所以双方都需要有一个确认的操作。第二个，TCP协议需要在一个不可靠的网络环境下去实现一个可靠的数据传输，意味着通信双方必须要通过某种手段来实现一个可靠的数据传输的一个通道，而三次通信是建立这样一个通道的最小值，当然我们还可以通过4次5次只是没必要去浪费这样1个资源而已。
	第三个防止历史的重复连接初始化造成的一个混乱问题。比如说在网络比较差的情况下，客户端多次发送建立连接的一个请求，假设只有两次握手，那么服务端只能选择接受或者拒绝这样一个连接，但是服务端并不知道这次请求是不是之前因为网络堵塞而过激的一个近郊，也是说服务端不知道当前的客户端请求是有效还是无效的。以上就是我对这个问题的一个理解。网络通信这块内容呢还是非常重要的。我们在面对一些线上网络故障排查的时候，可以快速的去帮助我们去定位问题，并且找到解决办法。好的，本期的普通人vs高手的面试系列的视频就到这结束了。我是麦克一个工作了，14年的Java程序员，咱们下期再见。