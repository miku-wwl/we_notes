MySQL中的索引是为了加快数据检索速度而创建的数据结构。然而，在某些情况下，尽管存在索引，MySQL查询优化器仍然会选择不使用索引来执行查询。以下是导致索引失效的一些常见情况：

### 1. 使用 OR 条件连接多个表达式

如果在一个查询中使用了`OR`来连接多个条件，并且其中一个条件无法使用索引，则整个查询可能都不会使用索引。

#### 示例：
```sql
SELECT * FROM table WHERE id = 1 OR name LIKE '%test%';
```
在这种情况下，如果`id`上有索引，但是`name`上没有索引，MySQL可能会选择全表扫描而不是使用索引。

### 2. 不匹配的索引前缀

如果你使用的是复合索引（多个字段组成的索引），那么查询条件必须按照索引的字段顺序进行匹配，否则索引可能不会被使用。

#### 示例：
如果你有一个索引 `(col1, col2)`，那么查询条件应该如下所示才会使用索引：
```sql
SELECT * FROM table WHERE col1 = 'value' AND col2 = 'value2';
```
如果查询条件不按照索引的字段顺序，则索引可能不会被使用：
```sql
SELECT * FROM table WHERE col2 = 'value2' AND col1 = 'value';
```

### 3. 使用 LIKE 操作符开头为通配符

当使用`LIKE`操作符且通配符`%`位于开头时，索引将不起作用，因为这种情况下MySQL需要扫描整个表来匹配数据。

#### 示例：
```sql
SELECT * FROM table WHERE name LIKE '%test%';
```
但是，如果通配符位于字符串末尾，则索引仍然可能被使用：
```sql
SELECT * FROM table WHERE name LIKE 'test%';
```

### 4. 使用函数或表达式

如果查询条件中包含了对字段的函数操作或数学表达式，那么索引将不会被使用，因为索引存储的是原始数据值。

#### 示例：
```sql
SELECT * FROM table WHERE YEAR(date_col) = 2020;
```
在这种情况下，索引不会被使用，因为索引存储的是`date_col`的原始值，而不是经过`YEAR()`函数处理后的值。

### 5. 使用 NOT IN 或者 NOT EXISTS

在某些情况下，使用`NOT IN`或`NOT EXISTS`可能导致索引失效，因为MySQL很难优化这类查询。

#### 示例：
```sql
SELECT * FROM table WHERE id NOT IN (SELECT id FROM other_table);
```
这种查询通常会导致全表扫描，而不是使用索引。

### 6. 过滤条件与索引列不匹配

如果过滤条件与索引列不完全匹配，索引可能不会被使用。

#### 示例：
假设有一个索引 `(status, created_at)`，以下查询可能不会使用索引：
```sql
SELECT * FROM table WHERE status = 'active' AND created_at > '2020-01-01';
```
但如果查询如下，则索引可能不会被使用，因为`created_at`的比较操作符与索引不匹配：
```sql
SELECT * FROM table WHERE status = 'active' AND created_at BETWEEN '2020-01-01' AND '2020-12-31';
```

### 7. 使用 IS NULL 或 IS NOT NULL

对于某些版本的MySQL，使用`IS NULL`或`IS NOT NULL`的条件时，即使字段上有索引，也可能不会使用索引。

#### 示例：
```sql
SELECT * FROM table WHERE col IS NULL;
```

### 8. 索引选择性不高

如果索引的选择性不高（即索引覆盖的数据比例太高），MySQL可能会选择全表扫描而不是使用索引。

### 9. MySQL 查询优化器决定

有时MySQL的查询优化器可能会决定不使用索引，因为它认为其他方法更快。

### 10. 索引被覆盖

如果查询条件覆盖了索引的所有列，但没有选择索引的第一列，索引可能不会被使用。

### 总结

为了确保索引能够被有效利用，建议在设计查询时注意上述提到的几点。使用`EXPLAIN`语句可以帮助你理解MySQL查询优化器是如何处理你的查询的，从而判断索引是否被使用。如果发现索引没有被使用，可以考虑调整查询语句或重新评估索引的设计。

/**/
Misko索引什么情况下会失效？昨天一个工作了，一年的粉丝好不容易拿到一个面试机会，结果在一个简单的问题上挂了，有点可惜卖c口，所以失效这个问题面试水平也很高，但同时也很简单，我把完整的回答思路整理到了一个30万字的大场电视指南里面，它可以在我的评论区的治理中去领取。下面说一下我的回答思路，第一，没有使用索引列作为VR指数的一个查询条件。第二对索引链进行函数操作，比如字符串操作或者日记操作，MAC狗呢无法使用索引，这个时候索引呢会失效，因为买水果没有办法去在运行的时候使用函数计算来做索引匹配。第三对索引链进行类型转化。如果所以你也是数字类型，但是你传入的值呢是这么算，那么这个时候我们卖c口会默认对类型进行转化，同样会导致所以实效。第四，liked查询的查询字符串，以通被俘开头，当我们使用like查询的时候，并且查询字符串，以通配符为开头的时候，MAC口无法使用索引，因为通配符在开头的时候没有办法进行一个最多匹配。第五or条件查询，当查询条件中包括or条件的时候，如果or条件中的每个条件都不涉及到收银链，卖切口呢是无法使用索引。
	第六查询条件涉及到大量数据，当查询条件涉及大量数据的时候，假如返回表中的大部分数据查询的时候，那结果认为可能使用索引意义并不大，所以呢也不会使用索引。好的，对于这样一个问题啊大家不需要去回答说百%的完美，你们只需要把一些关键的点说清楚，面试官能够感受到你的一个理解或者一个知识深度就好了。Ok今天的分享就到这里，感谢大家的点赞和关注。我们下期再见，拜拜。
